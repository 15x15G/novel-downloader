// ==UserScript==
// @name        小说下载器测试脚本
// @version     4.4.1.286
// @author      bgme
// @description 小说下载器测试脚本
// @match       *://www.ciweimao.com/chapter-list/*
// @match       *://book.sfacg.com/Novel/*/MainIndex/
// @match       *://book.qidian.com/info/*
// @match       *://www.jjwxc.net/onebook.php?novelid=*
// @match       *://www.gongzicp.com/novel-*.html
// @match       *://gongzicp.com/novel-*.html
// @match       *://book.zongheng.com/showchapter/*.html
// @match       *://huayu.zongheng.com/showchapter/*.html
// @match       *://www.linovel.net/book/*.html
// @match       *://www.17k.com/list/*.html
// @match       *://www.shuhai.com/book/*.htm
// @match       *://mm.shuhai.com/book/*.htm
// @match       *://www.tadu.com/book/*
// @match       *://www.qimao.com/shuku/*/
// @match       *://sosad.fun/threads/*/profile*
// @match       *://wenzhan.org/threads/*/profile*
// @match       *://sosadfun.com/threads/*/profile*
// @match       *://xn--pxtr7m5ny.com/threads/*/profile*
// @match       *://xn--pxtr7m.com/threads/*/profile*
// @match       *://xn--pxtr7m5ny.net/threads/*/profile*
// @match       *://xn--pxtr7m.net/threads/*/profile*
// @match       *://sosadfun.link/threads/*/profile*
// @match       *://www.sosad.fun/threads/*/profile*
// @match       *://www.wenzhan.org/threads/*/profile*
// @match       *://www.sosadfun.com/threads/*/profile*
// @match       *://www.xn--pxtr7m5ny.com/threads/*/profile*
// @match       *://www.xn--pxtr7m.com/threads/*/profile*
// @match       *://www.xn--pxtr7m5ny.net/threads/*/profile*
// @match       *://www.xn--pxtr7m.net/threads/*/profile*
// @match       *://www.sosadfun.link/threads/*/profile*
// @match       *://www.uukanshu.com/b/*/
// @match       *://www.yruan.com/article/*.html
// @match       *://www.biquwoo.com/bqw*/
// @match       *://www.biquwo.org/bqw*/
// @match       *://www.shuquge.com/txt/*/index.html
// @match       *://www.sizhicn.com/txt/*/index.html
// @match       *://www.dingdiann.net/ddk*/
// @match       *://www.xkzw.org/xkzw*/
// @match       *://www.lewenn.com/lw*/
// @match       *://www.klxs.la/info-*/
// @match       *://www.266ks.com/*_*/
// @match       *://www.266ks.com/*_*/index*.html
// @match       *://www.hetushu.com/book/*/index.html
// @match       *://hetushu.com/book/*/index.html
// @match       *://www.shouda8.com/*/
// @match       *://www.shouda88.com/*/
// @match       *://www.gebiqu.com/biquge_*/
// @match       *://www.meegoq.com/book*.html
// @match       *://www.viviyzw.com/book*.html
// @match       *://www.xiaoshuodaquan.com/*/
// @match       *://www.1pwx.com/*/
// @match       *://1pwx.com/*/
// @match       *://www.81book.com/book/*/
// @match       *://www.81zw.com/book/*/
// @match       *://m.yuzhaige.cc/*/*/
// @match       *://m.yushuge123.com/*/*/
// @match       *://www.xinwanben.com/*/
// @match       *://www.idejian.com/book/*/
// @match       *://www.wenku8.net/novel/*/*/index.htm
// @match       *://www.dmzj.com/info/*.html
// @match       *://www.westnovel.com/*/*/
// @match       *://www.mht.tw/*/
// @match       *://www.mht99.com/*/
// @match       *://www.dierbanzhu1.com/*_*/
// @match       *://www.banzhuer.org/*_*/
// @match       *://www.xbiquge.so/book/*/
// @match       *://www.hongyeshuzhai.com/shuzhai/*/
// @match       *://www.linovelib.com/novel/*/catalog
// @match       *://www.luoqiuzw.com/book/*/
// @match       *://www.yibige.la/*/
// @match       *://www.fushuwang.org/*/*/*/*.html
// @match       *://www.fushuwang.org/*/*/*/*.html?*
// @match       *://www.soxscc.net/*/
// @match       *://www.soxscc.org/*/
// @match       *://www.soxs.cc/*/
// @match       *://www.soshuw.com/*/
// @match       *://www.soshuwu.org/*/
// @match       *://www.soxscc.cc/*/
// @match       *://www.soshuwu.com/*/
// @match       *://www.kubiji.net/*/
// @match       *://www.shubaowa.org/*_*/
// @match       *://www.fuguoduxs.com/*_*/
// @match       *://www.xyqxs.cc/html/*/*/index.html
// @match       *://www.630shu.net/shu/*.html
// @match       *://www.qingoo.cn/details?bookId=*
// @match       *://www.trxs.cc/tongren/*.html
// @match       *://www.trxs123.com/tongren/*.html
// @match       *://www.jpxs123.com/*/*.html
// @match       *://trxs.cc/tongren/*.html
// @match       *://trxs123.com/tongren/*.html
// @match       *://jpxs123.com/*/*.html
// @match       *://www.tongrenquan.org/tongren/*.html
// @match       *://www.tongrenquan.me/tongren/*.html
// @match       *://tongrenquan.me/tongren/*.html
// @match       *://www.imiaobige.com/read/*/
// @match       *://www.256wxc.com/read/*/index.html
// @match       *://www.256wxc.com/read/*/
// @match       *://www.256wenku.com/read/*/index.html
// @match       *://www.256wenku.com/read/*/
// @match       *://www.biquge66.com/biquge*/
// @match       *://*.lofter.com/
// @match       *://*.lofter.com/?page=*
// @match       *://www.lwxs9.org/*/*/
// @match       *://www.shubl.com/book/book_detail/*
// @match       *://www.ujxs.net/read/*/
// @match       *://m.haitangtxt.net/*/*/
// @match       *://ebook.longmabook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.longmabookcn.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://ebook.lmbooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.lmebooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.haitbook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.htwhbook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.myhtebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.lovehtbooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.myhtebooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.myhtlmebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://jp.myhtebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://jp.myhtlmebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://ebook.urhtbooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.urhtbooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.newhtbook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.lvhtebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://jp.lvhtebook.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://www.htlvbooks.com/?act=showinfo&bookwritercode=*&bookid=*
// @match       *://dijiubook.net/*_*/
// @match       *://www.biquwx.la/*_*/
// @match       *://www.25zw.com/*/
// @match       https://greasyfork.org/*/scripts/406070-%E5%B0%8F%E8%AF%B4%E4%B8%8B%E8%BD%BD%E5%99%A8
// @name:en     novel-downloader-tester
// @namespace   https://blog.bgme.me
// @icon        https://cdn.jsdelivr.net/gh/yingziwu/novel-downloader/assets/icon.png
// @license     AGPL-3.0
// @run-at      document-start
// @noframes    true
// @exclude     *://www.jjwxc.net/onebook.php?novelid=*&chapterid=*
// @exclude     *://www.meegoq.com/book/*.html
// @exclude     *://www.viviyzw.com/book/*.html
// @exclude     *://www.yruan.com/article/*/*.html
// @exclude     *://m.yuzhaige.cc/tag/*/
// @exclude     *://m.yuzhaige.cc/sort/*/
// @exclude     *://m.yuzhaige.cc/top/*/
// @exclude     *://m.yuzhaige.cc/full/*/
// @exclude     *://m.yuzhaige.cc/book/*/
// @exclude     *://m.yushuge123.com/tag/*/
// @exclude     *://m.yushuge123.com/sort/*/
// @exclude     *://m.yushuge123.com/top/*/
// @exclude     *://m.yushuge123.com/full/*/
// @exclude     *://m.yushuge123.com/book/*/
// @exclude     *://www.linovel.net/book/*/*.html
// @exclude     *://www.qimao.com/shuku/*-*/
// @exclude     *://www.trxs.cc/tongren/*/*.html
// @exclude     *://www.trxs123.com/tongren/*/*.html
// @exclude     *://www.tongrenquan.org/tongren/*/*.html
// @exclude     *://tongrenquan.org/tongren/*/*.html
// @exclude     *://www.jpxs123.com/*/*/*.html
// @exclude     *://m.haitangtxt.net/tag/*/
// @exclude     *://m.haitangtxt.net/sort/*/
// @exclude     *://m.haitangtxt.net/top/*/
// @exclude     *://m.haitangtxt.net/full/*/
// @exclude     *://m.haitangtxt.net/book/*/
// @exclude     *://www.tadu.com/book/*/*/*
// @exclude     *://www.tadu.com/book/*/0*
// @exclude     *://www.tadu.com/book/*/1*
// @exclude     *://www.tadu.com/book/*/2*
// @exclude     *://www.tadu.com/book/*/3*
// @exclude     *://www.tadu.com/book/*/4*
// @exclude     *://www.tadu.com/book/*/5*
// @exclude     *://www.tadu.com/book/*/6*
// @exclude     *://www.tadu.com/book/*/7*
// @exclude     *://www.tadu.com/book/*/8*
// @exclude     *://www.tadu.com/book/*/9*
// @exclude     *://www.25zw.com/lastupdate/
// @exclude     *://www.25zw.com/postdate/
// @exclude     *://www.25zw.com/monthvisit/
// @exclude     *://www.25zw.com/goodnum/
// @exclude     *://www.25zw.com/goodnew/
// @grant       unsafeWindow
// @grant       GM_openInTab
// @grant       window.close
// @grant       GM_getTab
// @grant       GM_saveTab
// @grant       GM_getTabs
// ==/UserScript==

/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it uses a non-standard name for the exports (exports).
(() => {
var exports = __webpack_exports__;
var __webpack_unused_export__;

__webpack_unused_export__ = ({ value: true });
const TabDataKeyName = "data-5186766268769811";
function setTabData(key, value) {
    return new Promise((resolve, reject) => {
        GM_getTab(async (curTabObject) => {
            const _tabData = await getTabData(document.location.hostname);
            let tabData;
            if (_tabData) {
                tabData = _tabData;
            }
            else {
                tabData = {};
            }
            tabData[key] = value;
            curTabObject[TabDataKeyName] = {
                domain: document.location.hostname,
                value: tabData,
            };
            GM_saveTab(curTabObject);
            resolve(tabData);
        });
    });
}
function getTabData(domain) {
    return new Promise((resolve, reject) => {
        GM_getTabs((curTabObjects) => {
            for (let i in curTabObjects) {
                const rawData = curTabObjects[i];
                if (typeof rawData === "undefined" ||
                    Object.keys(rawData).length === 0) {
                    continue;
                }
                let data;
                if (rawData[TabDataKeyName]) {
                    data = rawData[TabDataKeyName];
                }
                else {
                    continue;
                }
                const dataDomain = data.domain;
                const tabData = data.value;
                if (dataDomain === domain) {
                    resolve(tabData);
                }
            }
            resolve(null);
        });
    });
}
function deleteTabData(key) {
    return new Promise((resolve, reject) => {
        GM_getTab(async (curTabObject) => {
            const _tabData = await getTabData(document.location.hostname);
            let tabData;
            if (_tabData) {
                tabData = _tabData;
            }
            else {
                tabData = {};
            }
            if (tabData[key]) {
                delete tabData[key];
            }
            resolve(tabData);
        });
    });
}
function randomChoose(array) {
    return array[Math.floor(Math.random() * array.length)];
}
function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
if (document.location.origin === "https://greasyfork.org" &&
    document.location.pathname.includes("/scripts/406070-%E5%B0%8F%E8%AF%B4%E4%B8%8B%E8%BD%BD%E5%99%A8")) {
    const exampleUrls = [
        [
            "https://www.ciweimao.com/chapter-list/100244593/book_detail",
            "https://www.ciweimao.com/chapter-list/100243812/book_detail",
            "https://www.ciweimao.com/chapter-list/100248092/book_detail",
        ],
        [
            "https://book.sfacg.com/Novel/160284/MainIndex/",
            "https://book.sfacg.com/Novel/286895/MainIndex/",
            "https://book.sfacg.com/Novel/447540/MainIndex/",
        ],
        [
            "https://book.qidian.com/info/1019664125",
            "https://book.qidian.com/info/1021617576",
            "https://book.qidian.com/info/1021635590",
        ],
        [
            "http://www.jjwxc.net/onebook.php?novelid=2267777",
            "http://www.jjwxc.net/onebook.php?novelid=395278",
            "http://www.jjwxc.net/onebook.php?novelid=4306657",
        ],
        [
            "http://book.zongheng.com/showchapter/1108153.html",
            "http://book.zongheng.com/showchapter/1057288.html",
            "http://book.zongheng.com/showchapter/952586.html",
        ],
        [
            "http://huayu.zongheng.com/showchapter/867082.html",
            "http://huayu.zongheng.com/showchapter/1120889.html",
            "http://huayu.zongheng.com/showchapter/1086399.html",
        ],
        [
            "https://www.linovel.net/book/109856.html",
            "https://www.linovel.net/book/106056.html",
            "https://www.linovel.net/book/105330.html",
        ],
        [
            "https://www.17k.com/list/3006464.html",
            "https://www.17k.com/list/3038645.html",
            "https://www.17k.com/list/3301855.html",
        ],
        [
            "http://www.shuhai.com/book/54334.htm",
            "http://www.shuhai.com/book/37784.htm",
            "http://www.shuhai.com/book/701.htm",
        ],
        [
            "http://mm.shuhai.com/book/55973.htm",
            "http://mm.shuhai.com/book/90856.htm",
            "http://mm.shuhai.com/book/57557.htm",
        ],
        [
            "http://www.tadu.com/book/catalogue/803448",
            "http://www.tadu.com/book/catalogue/776168",
            "http://www.tadu.com/book/catalogue/786116",
        ],
        [
            "https://www.qimao.com/shuku/209902/",
            "https://www.qimao.com/shuku/199373/",
            "https://www.qimao.com/shuku/209859/",
        ],
        "https://sosad.fun/threads/7857/profile",
        "https://wenzhan.org/threads/8503/profile",
        [
            "https://sosadfun.com/threads/36426/profile",
            "https://sosadfun.com/threads/5163/profile",
        ],
        "https://xn--pxtr7m5ny.com/threads/8998/profile",
        "https://xn--pxtr7m.com/threads/3370/profile",
        "https://xn--pxtr7m5ny.net/threads/13628/profile",
        "https://xn--pxtr7m.net/threads/3841/profile",
        "https://sosadfun.link/threads/4330/profile",
        "https://www.sosad.fun/threads/7857/profile",
        "https://www.wenzhan.org/threads/8503/profile",
        "https://www.sosadfun.com/threads/36426/profile",
        "https://www.xn--pxtr7m5ny.com/threads/8998/profile",
        "https://www.xn--pxtr7m.com/threads/3370/profile",
        "https://www.xn--pxtr7m5ny.net/threads/13628/profile",
        "https://www.xn--pxtr7m.net/threads/3841/profile",
        "https://www.sosadfun.link/threads/4330/profile",
        "https://www.uukanshu.com/b/151226/",
        "https://www.yruan.com/article/107112.html",
        "https://www.biquwo.org/bqw195972/",
        "https://www.sizhicn.com/txt/63542/index.html",
        "https://www.dingdiann.net/ddk254569/",
        "http://www.xkzw.org/xkzw288143/",
        "https://www.lewenn.com/lw315781/",
        "https://www.klxs.la/info-291641/",
        "https://www.266ks.com/461_461525/",
        "https://www.266ks.com/1_1420/index_2.html",
        [
            "https://www.hetushu.com/book/4268/index.html",
            "https://www.hetushu.com/book/4308/index.html",
            "https://www.hetushu.com/book/5/index.html",
        ],
        "https://hetushu.com/book/5626/index.html",
        "https://www.shouda88.com/117454/",
        "http://www.gebiqu.com/biquge_2181/",
        "http://www.viviyzw.com/book76557.html",
        "https://www.1pwx.com/xueyinglingzhu/",
        "https://www.81book.com/book/10304/",
        "http://m.yuzhaige.cc/33/33249/",
        "https://www.xinwanben.com/93974973/",
        "https://www.idejian.com/book/11539708/",
        "https://www.wenku8.net/novel/1/1758/index.htm",
        "https://www.dmzj.com/info/naniannatunaxieshier.html",
        "https://www.westnovel.com/dd/lms/",
        "https://www.mht.tw/21661/",
        "https://www.mht99.com/21661/",
        "http://www.dierbanzhu1.com/3_3348/",
        "https://www.xbiquge.so/book/43106/",
        "https://www.hongyeshuzhai.com/shuzhai/56609/",
        [
            "https://www.linovelib.com/novel/111/catalog",
            "https://www.linovelib.com/novel/112/catalog",
            "https://www.linovelib.com/novel/2547/catalog",
        ],
        "https://www.luoqiuzw.com/book/65403/",
        "https://www.yibige.la/249688/",
        "https://www.fushuwang.org/chuanyuechongsheng/2021n/1/28196.html",
        "https://www.soxscc.net/QiLingFuYunXiaoJiaoQi/",
        "https://www.soxscc.org/ZhongShengXiaoYuanGuoMinNvShenZhuaiFanTian/",
        "https://www.soxs.cc/TunShiXingKong/",
        "https://www.kubiji.net/298802/",
        [
            "http://www.shubaowa.org/7_7914/",
            "http://www.shubaowa.org/0_2/",
            "http://www.shubaowa.org/11_11568/",
        ],
        [
            "https://www.fuguoduxs.com/5_5914/",
            "https://www.fuguoduxs.com/9_9668/",
            "https://www.fuguoduxs.com/4_4790/",
        ],
        [
            "https://www.xyqxs.cc/html/112/112859/index.html",
            "https://www.xyqxs.cc/html/0/186/index.html",
            "https://www.xyqxs.cc/html/47/47987/index.html",
        ],
        [
            "https://www.630shu.net/shu/145476.html",
            "https://www.630shu.net/shu/105670.html",
        ],
        "http://www.trxs.cc/tongren/1768.html",
        "http://www.trxs123.com/tongren/2952.html",
        [
            "http://www.jpxs123.com/tongren/5578.html",
            "http://www.jpxs123.com/book/3940.html",
            "http://www.jpxs123.com/dsxs/2724.html",
            "http://www.jpxs123.com/xuanhuan/zhetian.html",
        ],
        "http://trxs.cc/tongren/1768.html",
        "http://trxs123.com/tongren/2952.html",
        "http://jpxs123.com/tongren/5578.html",
        "https://www.imiaobige.com/read/173201/",
        "https://www.256wxc.com/read/68624/index.html",
        "https://www.256wenku.com/read/7667/",
        "http://www.biquge66.com/biquge263372/",
        [
            "https://caogousheng.lofter.com/",
            "https://caogousheng.lofter.com/?page=2&t=1599134400003",
            "https://shuju.lofter.com/",
            "https://wangnuannuan.lofter.com/",
            "https://geekhome.lofter.com/",
            "https://absb6.lofter.com/",
        ],
        "http://www.bq8xs.com/3399/",
        "http://www.tongrenquan.org/tongren/5730.html",
        "https://www.tongrenquan.me/tongren/5373.html",
        "https://tongrenquan.me/tongren/5753.html",
        "http://tongrenquan.org/tongren/5730.html",
        "https://www.lwxs9.org/5/5203/",
        [
            "https://www.shubl.com/book/book_detail/100308566",
            "https://www.shubl.com/book/book_detail/100254251",
            "https://www.shubl.com/book/book_detail/100374396",
        ],
        "https://www.ujxs.net/read/10494/",
        [
            "http://m.haitangtxt.net/book/101821/",
            "http://m.haitangtxt.net/book/101832/",
        ],
        "https://gongzicp.com/novel-341364.html",
        "https://www.gongzicp.com/novel-406782.html",
        "https://ebook.longmabook.com/?act=showinfo&bookwritercode=EB20171122105148478253",
    ];
    async function runTest() {
        setTabData("runTest", "true");
        const openWindow = (u) => {
            if (typeof u === "string") {
                GM_openInTab(u);
            }
            else if (Array.isArray(u)) {
                const url = randomChoose(u);
                GM_openInTab(url);
            }
        };
        for (const u of exampleUrls) {
            await sleep(500);
            openWindow(u);
        }
    }
    unsafeWindow.runTest = runTest;
}
else {
    window.addEventListener("DOMContentLoaded", () => {
        setTimeout(async () => {
            const runFlag = await getTabData("greasyfork.org");
            if (runFlag) {
                console.log("[novel-downloader-tester]开始运行测试……");
                function chapterFilter(chapter) {
                    return chapter.chapterNumber <= 20;
                }
                unsafeWindow.chapterFilter = chapterFilter;
                function customFinishCallback(book) {
                    window.close();
                }
                unsafeWindow.customFinishCallback = customFinishCallback;
                document.getElementById("novel-downloader")?.click();
            }
        }, 1000 + Math.random() * 3000);
    });
}
console.log("[novel-downloader-tester]测试脚本载入成功……");

})();

/******/ })()
;